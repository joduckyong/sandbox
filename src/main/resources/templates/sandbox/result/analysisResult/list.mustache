{{>layout/header}}

        <div class="right_col" role="main">
          <div class="row">
            <div class="col-md-12">
              <div class="x_panel"> 
                <div class="x_title"> 
                  <h2>HOME > 데이터 분석 > 데이터 분석 결과 조회</h2>
                  <div class="clearfix"> </div>
                </div>
                <div class="x_content"> <br>
                  <!-- div class="scenario_depth"> 
                    <ul>
                      <li class="now_depth">HOME</li>
                      <li class="temporary_storage">데이터 분석</li>
                      <li class="save">분석 데이터셋 관리</li>
                    </ul>
                  </div-->
                  
	              <h3 class="mb-4">결과 조회</h3>
                  <div class="table_responsive">
                    <table class="table table-bordered bulk_action table_center" id="sandboxTable">
                      <colgroup> 
                        <col width="50px">
                        <col width="110px">
                        <col width="110px">
                        <col width="70px">
                        <col width="80px">
                        <col width="70px">
                        <col width="70px">
                        <col width="70px">
                        <col width="70px">
                        <col width="70px">
                        <col width="70px">
                        <col width="80px">
                        <col width="80px">
                      </colgroup>
                      <thead>
                        <tr> 
                          <th rowspan="2">#</th>
                          <th rowspan="2">결과 수행<br>시작 시각</th>
                          <th rowspan="2">결과 수행<br>완료 시각</th>
                          <th rowspan="2">진행 상태</th>
                          <th rowspan="2">원본<br>데이터수</th>
                          <th rowspan="2">전처리 결과<br>데이터 수</th>
                          <th colspan="3">학습 데이터 수</th>
                          <th rowspan="2">분석<br>데이터 수</th>
                          <th rowspan="2">모델<br>정확도 [%]</th>
                          <th rowspan="2">다운로드</th>
                          <th rowspan="2">결과<br>조회</th>
                        </tr>
                        <tr>
                          <th>학습</th>
                          <th>검증</th>
                          <th>테스트</th>
                        </tr>                        
                      </thead>
                      <tbody id="sandboxResultsGet">
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- code_modal -->
        <div class="modal fade add_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-lg" style="max-width: 550px;">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">분석모델 등록 팝업</h4>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
                <form class="form-horizontal form-label-left">
                  <div class="row">
                    <div class="form-group row col-12 col-md-12">
                      <label class="control-label">이미지 데이터셋 이름<span class="red bold">*</span></label>
                      <div class="form-control_box">
                        <input class="form-control" type="text">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="form-group row col-12 col-md-12">
                      <label class="control-label">설명<span class="red bold">*</span></label>
                      <div class="form-control_box">
                        <input class="form-control" type="text">
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" type="button">등록</button>
                <button class="btn btn-dark" type="button">닫기</button>
              </div>
            </div>
          </div>
        </div>

        <!-- download_modal -->
        <div class="modal fade download_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">결과 정보 및 다운로드</h4>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
                <div class="x_content">
                  <h5 class="mb-4s big_font">[pm10_analysis] 분석 모델 정보 </h5>
                  <ul class="nav nav-tabs bar_tabs">
                    <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#dataset">데이터셋</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#preprocessing">전처리모델</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#analysisModel">분석 모델</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#analysisFile">분석 파일</a></li>
                  </ul>
                  <div class="tab-content">
                    <div class="tab-pane fade show active" id="dataset" role="tabpanel">
                      <h5>분석 데이터셋 정보</h5>
                      <div class="table_responsive table-modal-height">
                        <table class="table table-striped table_center">
                          <colgroup>
	                        <col width="40px">
	                        <col width="160px">
	                        <col width="100px">
	                        <col width="100px">
	                        <col width="100px">
	                        <col width="100px">                          
                          </colgroup>
                          <thead>
                            <tr> 
                              <th rowspan="2">#</th>
                              <th rowspan="2">이미지 데이터셋 이름</th>
                              <th colspan="3">파일 수(용량, MB)</th>
                              <th rowspan="2">최종 등록 일자</th>
                            </tr>
                            <tr> 
                              <th>학습</th>
                              <th>검증</th>
                              <th>테스트</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>1</td>
                              <td>한옥</td>
                              <td>10</td>
                              <td>10</td>
                              <td>10</td>
                              <td>2022.12.11</td>
                            </tr>
                            <tr>
                              <td>2</td>
                              <td>한옥</td>
                              <td>10</td>
                              <td>10</td>
                              <td>10</td>
                              <td>2022.12.11</td>
                            </tr>
                            <tr>
                              <td>3</td>
                              <td>한옥</td>
                              <td>10</td>
                              <td>10</td>
                              <td>10</td>
                              <td>2022.12.11</td>
                            </tr>
                            <tr>
                              <td colspan="2">총 데이터셋</td>
                              <td>10</td>
                              <td>10</td>
                              <td>10</td>
                              <td>2022.12.11</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="right_btns"> <a class="btn btn-primary" href="" >다운로드 </a>
                        <button class="btn btn-secondary" data-dismiss="modal">닫기 </button>
                      </div>
                    </div>
                    <div class="tab-pane fade show " id="preprocessing" role="tabpanel">
                      <h5>데이터 전처리 모델 정보</h5>
                      <div class="table_responsive table-modal-height">
                        <table class="table table-striped table_center">
                          <colgroup>
							<col width="30px">
							<col width="100px">
							<col width="100px">
						  </colgroup>
                          <thead>
                            <tr> 
                              <th><input class="flat" type="checkbox" name="table_records"></th>
                              <th>데이터 전처리 모델명</th>
                              <th>생성 일자</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><input class="flat" type="checkbox" name="table_records"></td>
                              <td>모델명Ah5</td>
                              <td>2020.12.12</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="right_btns"> <a class="btn btn-primary" href="" download>다운로드 </a>
                        <button class="btn btn-secondary" data-dismiss="modal">닫기 </button>
                      </div>
                    </div>
                    <div class="tab-pane fade show " id="analysisModel" role="tabpanel">
                      <h5>분석 모델 정보</h5>
                      <div class="table_responsive table-modal-height">
                        <table class="table table-striped table_center">
                          <colgroup>
							<col width="30px">
							<col width="100px">
							<col width="100px">
						  </colgroup>
                          <thead>
                            <tr> 
                              <th><input class="flat" type="checkbox" name="table_records"></th>
                              <th>분석 모델명</th>
                              <th>생성 일자</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><input class="flat" type="checkbox" name="table_records"></td>
                              <td>모델명Ah5</td>
                              <td>2020.12.12</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="right_btns"> <a class="btn btn-primary" href="" download>다운로드 </a>
                        <button class="btn btn-secondary" data-dismiss="modal">닫기 </button>
                      </div>
                    </div>
                    <div class="tab-pane fade show " id="analysisFile" role="tabpanel">
                      <h5>분석 모델 관련 파일 정보</h5>
                      <div class="table_responsive table-modal-height">
                        <table class="table table-striped table_center">
                          <colgroup>
							<col width="30px">
							<col width="100px">
							<col width="100px">
						  </colgroup>
                          <thead>
                            <tr> 
                              <th><input class="flat" type="checkbox" name="table_records"></th>
                              <th>분석 파일명</th>
                              <th>생성 일자</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td><input class="flat" type="checkbox" name="table_records"></td>
                              <td>모델명A_관련파일.py</td>
                              <td>2020.12.11</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="right_btns"> <a class="btn btn-primary" href="" download>다운로드 </a>
                        <button class="btn btn-secondary" data-dismiss="modal">닫기 </button>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="preprocessing" role="tabpanel"></div>
                    <div class="tab-pane fade" id="analysisModel" role="tabpanel"></div>
                    <div class="tab-pane fade" id="analysisFile" role="tabpanel"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>    
                        
{{>layout/footer}}        

<script>
document.title = "LX DT | 데이터 분석 결과 조회"; 
const commonUrl = '/sandbox/common';
const url = '/sandbox/result/analysisResult';

const sandboxResultsGet = function(){
	const data = {
       		url: '/services/sandbox/sandboxes/{{sandbox_id}}/results/get',
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',	            		
        };		
        $.ajax({
            type: 'POST',
            url: url+'/sandboxResultsGet',
            dataType: 'json',
            contentType: 'application/json; charset-utf-8',
            data: JSON.stringify(data)
        }).done(function (data) {
 		  	if (data != null) {
 		  	   	if(data.contents != ""){    	    
					$("#sandboxResultsGet").empty();
		     	    let i = 0;	
	     	        let insertTr = '';
			  	    $.each(data.contents.contents, function (idx, el) {
		                  insertTr += '<tr>';
		                  insertTr += ' <td style="text-align: center;">'+(++i)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.analysis_exec_start_time)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.analysis_exec_complete_time)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.result_status)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.orgin_data_cnt)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.pretreat_result_data_cnt)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.train_data_cnt)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.valid_data_cnt)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.test_data_cnt)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.analysis_data_cnt)+'</td>';
		                  insertTr += ' <td style="text-align: center;">'+isEmpty(el.model_accuracy)+'</td>';
		                  if(el.analysis_complete_yn == 'Y'){
			                  insertTr += ' <td style="text-align: center;"><a class="btn btn-primary" href="" data-toggle="modal" data-target=".download_modal">다운로드 </a></td>';
			                  insertTr += ' <td style="text-align: center;cursor:pointer" onclick=result("object","'+isEmpty(el.result_id)+'")>결과조회</td>';
		                  }else{
			                  insertTr += ' <td style="text-align: center;"></td>';
			                  insertTr += ' <td style="text-align: center;"></td>';
		                  }
		                  insertTr += '</tr>';
		                  insertTr += '<tr>';
				    });     	
          	   	    $("#sandboxResultsGet").append(insertTr);
 		  	   	}
 		  	   	
 		  	}
        }).fail(function (error) {
            alert(JSON.stringify(error));
        });	
}

sandboxResultsGet();

//시계열 분석
const timeseriesStep1 = function(result_id){
	location.href = '/sandbox/result/timeseriesAnalysis/step1/{{sandbox_id}}/'+result_id;
}
//객체감지
const objectStep1 = function(result_id){
	location.href = '/sandbox/result/objectDetection/step1/{{sandbox_id}}/'+result_id;
}
//결과조회 선택
const result = function(type, result_id){
	if(type == 'time'){
		timeseriesStep1(result_id);
	}else{
		objectStep1(result_id);
	}
}

</script>


