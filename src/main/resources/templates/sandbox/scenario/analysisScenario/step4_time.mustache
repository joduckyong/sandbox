{{>layout/header}}
<style type="text/css">
.left_tbl tr:hover { 
	background-color: #ffffe0 !important;
	cursor : pointer;
}
.left_tbl tr.on {
	background-color: #ffffe0 !important;
}
</style>
        <div class="right_col" role="main">
          <div class="row">
            <div class="col-md-12">
              <div class="x_panel"> 
                <div class="x_title"> 
                  <h2>시나리오</h2>
                  <div class="clearfix"> </div>
                </div>
                <div class="x_content"> <br>
                  <div class="scenario_depth"> 
                    <ul>
                      <li id="ps1">시나리오 작성</li>
                      <li id="ps2">분석모델 설정</li>
                      <li id="ps3">전처리 모델 설정</li>
                      <li id="ps4">분석 대상 설정</li>
                    </ul>
                  </div>
                  <div>
                    <div class="tab_item">
                      <h3>▣ 분석 시나리오 세부 정보 입력 - 분석 데이터셋 등록 </h3>
                      <div class="row mx-0">
                        <h4 class="center_title">분석 데이터셋 이름</h4>
                        <div class="form-group row col-12 col-md-12 mx-0">
                          <label class="control-label">분석 데이터셋 이름 <span class="red">*</span></label>
                          <div class="form-control_box col-md-10">
                            <input class="form-control" type="text" name="anals_dataset_nm" id="anals_dataset_nm">
                          </div>
                        </div>
                      </div>
                      <div class="row">
                         <h4 class="mt-4 center_title">분석 데이터셋 파일 검색 및 등록</h4>
                         <div class="x_content">
                         	<div class="col-6">
	                         	<div class="right_btns"> 
				                    <div class="row port_search">
				                      <select class="form-control" name="schemaname" id="schemaname">
				                      </select>
				                      <div class="form-group row">
				                        <div class="form-control_box">
				                          <input class="form-control" type="text" name="query" id="query" onkeypress="enterkey(event);">
				                        </div>
				                      </div>
				                      <button class="btn btn-primary btn-sm" onclick="analysisTargetTableDatasetsGet();">조회</button>
				                    </div>
			                  	</div>
		                  	</div>
                         </div>
                         <div class="metatable_box col-6">
                          	<div class="form-group row">
	                          <div class="table_responsive" style="height: 300px; overflow: auto">
	                            <table class="table table-striped table-bordered bulk_action">
	                              <colgroup>
	                                <col width="55px">
	                              </colgroup>
	                              <thead>
	                                <tr>
	                                  <th>등록여부</th>
	                                  <th>스키마명</th>
	                                  <th>분석 테이블명</th>
	                                </tr>
	                              </thead>
	                              <tbody class="left_tbl" id="tableDataset">
	                              </tbody>
	                            </table>
	                          </div>
	                   		</div>
                   	  	</div>
                   	  	<div class="metatable_box col-6 col-lg-6">
                          <div class="form-group row">
	                          <div class="table_responsive" style="height: 300px; overflow: auto">
	                            <table class="table table-striped table-bordered bulk_action">
	                              <colgroup>
	                                <col width="55px">
	                              </colgroup>
	                              <thead>
	                                <tr>
	                                  <th>선택</th>
	                                  <th>컬럼명(영문)</th>
	                                  <th>컬럼 타입</th>
	                                  <th>컬럼 길이</th>
	                                </tr>
	                              </thead>
	                              <tbody id="columnDataset">
	                              </tbody>
	                            </table>
	                          </div>
	                    	</div>
                   	  	</div>
                      </div>
                      <div class="row">
                         <h4 class="mt-4 center_title">분석 데이터셋 컬럼 정의 <span class="red bold">*</span></h4>
                         <div class="metatable_box col-12">
                          	<div class="form-group row">
	                          <div class="table_responsive" id="tableColumnTbl" style="height: 300px; overflow: auto">
	                            <table class="table table-striped table-bordered bulk_action">
	                              <colgroup>
	                                <col width="55px">
	                              </colgroup>
	                              <thead>
	                                <tr>
	                                  <th>#</th>
	                                  <th>스키마명</th>
	                                  <th>분석 테이블명</th>
	                                  <th>컬럼명</th>
	                                  <th>Input Data</th>
	                                  <th>Output Data</th>
	                                  <th>데이터 기준 컬럼</th>
	                                </tr>
	                              </thead>
	                              <tbody id="tableColumnDataset">
	                              </tbody>
	                            </table>
	                          </div>
	                   		</div>
                   	  	</div>
                      </div>
                      <div class="row"> 
	                    <div class="metatable_box col-12">
	                      <h4 class="center_title">분석 데이터셋 설명</h4>
	                      <div class="form-group row">
	                        <label class="control-label">분석 데이터셋 설명</label>
	                        <div class="form-control_box duplicate_box">
	                          <input class="form-control" type="text" name="anals_dataset_desc" id="anals_dataset_desc" placeholder="분석 데이터셋 설명">
	                        </div>
	                      </div>
	                    </div>
	                  </div>
                      <div class="right_btns mt-4">
                        <button class="btn btn-secondary" onclick="jsNext('P');">이전</button>
                        <button class="btn btn-warning" onclick="analysisTagetTableDatasetUpdate('T');">임시저장</button>
                        <button class="btn btn-success" onclick="analysisTagetTableDatasetUpdate('N');">등록</button>
                        <button class="btn btn-primary" onclick="jsList();">목록</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- modal -->
        <div class="modal fade add_modal" id="add_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-md">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel"><span id="modelLabel">샘플 데이터 팝업</span></h4>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
                <div class="x_content"> 
                  <div class="table_responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr> 
                          <th colspan="2">▣ 테이블 정보</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                  <div class="border_rows">
                    <div class="row">
                      <div class="form-group row col-12 col-md-12">
                        <div class="control-label">테이블명(한글)</div>
                        <div class="form-control_box" id="schema_nm"></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-12">
                        <div class="control-label">테이블명(영문)</div>
                        <div class="form-control_box" id="table_nm"></div>
                      </div>
                    </div>
                  </div>
                  <div class="table_responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr> 
                          <th colspan="2">▣ 샘플 데이터</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                  <div class="table_responsive" style="height: 300px; overflow-y: auto;">
                    <table class="table table-striped">
                   	  <colgroup> 
                        <col width="55px">
                      </colgroup>
                      <thead id="sampleDatasetColumn">
                      </thead>
                      <tbody id="sampleDatasetData">
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" type="button" data-dismiss="modal">확인</button>
              </div>
            </div>
          </div>
        </div>
        <input type="hidden" name="regst_status_cd" id="regst_status_cd"/>
        <input type="hidden" name="model_setup_status_cd" id="model_setup_status_cd"/>
        <input type="hidden" name="pretreat_status_cd" id="pretreat_status_cd"/>
        <input type="hidden" name="target_setup_status_cd" id="target_setup_status_cd"/>
        <input type="hidden" name="last_status_cd" id="last_status_cd"/>
        
{{>layout/footer}}        

<script>
const commonUrl = '/sandbox/common';
const url = '/sandbox/scenario/analysisScenario';

const progressCd1 = 'B03001';	//등록 중
const progressCd2 = 'B03002';	//등록 완료

const setupCd1 = 'B01001'	//분석 대상만 설정
const setupCd2 = 'B01002'	//분석 모델, 전처리 모델, 분석 대상 설정

let tbl_set = new Set();	//테이블 등록여부 체크 용도

$(document).ready(function(){
	let anals_detail_setting_cd = '{{anals_detail_setting_cd}}';
	let target_setup_status_cd = $("#target_setup_status_cd").val();
	
	if($("#regst_status_cd").val() != progressCd2){
		alert("시나리오 작성이 완료되지 않았습니다. 시나리오 작성 페이지로 이동합니다.");
		jsNext(1);
		return;
	}
	
	if(anals_detail_setting_cd == setupCd2){	//분석 모델, 전처리 모델, 분석 대상 설정
		if($("#model_setup_status_cd").val() != progressCd2){
			alert("분석모델 설정이 완료되지 않았습니다. 분석모델 설정 페이지로 이동합니다.");
			jsNext(2);
			return;
		}
		
		if($("#pretreat_status_cd").val() != progressCd2){
			alert("전처리 모델 설정이 완료되지 않았습니다. 분석모델 설정 페이지로 이동합니다.");
			jsNext(3);
			return;
		}
	}
	
	progressBar();
	
	if(target_setup_status_cd == progressCd1 || target_setup_status_cd == progressCd2){	//수정화면
		analysisTargetTableDatasetsDetail();
	}
});

//시나리오 등록 단계별 상태
const scenarioEnrollStepStatus = function (){
	let scenario_id = '{{scenario_id}}';
	if(!scenario_id){
		return;
	}
	
	const data = {
   		url: '/services/sandbox/scenarios/'+scenario_id+'/enroll-status',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
	$.ajax({
        type: 'POST',
        url: url+'/scenarioEnrollStepStatus',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data),
        async: false,
    }).done(function (data) {
    	
    	 if (data != null) {
   	    	
   	    	if(data.contents != ""){
   	    		$("#regst_status_cd").val(data.contents.regst_status_cd);
   	    		$("#model_setup_status_cd").val(data.contents.model_setup_status_cd);
   	    		$("#pretreat_status_cd").val(data.contents.pretreat_status_cd);
   	    		$("#target_setup_status_cd").val(data.contents.target_setup_status_cd);
   	    		$("#last_status_cd").val(data.contents.last_status_cd);
   	    	}
    	 }
  		
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//시나리오 등록 > 분석 대상 설정 스키마 조회
const analysisTargetSchemaGet = function () {
	
	const data = {
   		url: '/services/sandbox/B13001/scenarios/analysis-target/schema/get',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/analysisTargetSchemaGet',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#schemaname").empty();
  	    	
  	    	if(data.contents != ""){
  	    		let insertTr = '<option value="">스키마명</option>';
		  	    $.each(data.contents, function (idx, schema) {
		  	    	insertTr += '<option value="'+schema+'">'+schema+'</option>';
		  	    });
		  	  $("#schemaname").html(insertTr);
  	    	}
	  	  }
	  	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//시나리오 등록 > 분석 대상 설정 테이블 조회
const analysisTargetTableDatasetsGet = function () {
	
	let query = isEmpty($("#query").val());
	let schemaname = $("#schemaname").val();
	
	if(!schemaname){
		alert('스키마명을 선택하세요!');
        return;		
	}
	
	const data = {
   		url: '/services/sandbox/B13001/scenarios/analysis-target/tables/get?search=schemaname:'+schemaname+',tablename:'+query+'',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/analysisTargetTableDatasetsGet',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#tableDataset").empty();
	  		$("#columnDataset").empty();
  	    	
  	    	if(data.contents != ""){
  	    		let insertTr = '';
		  	    $.each(data.contents, function (idx, el) {
		  	    	let table_id = el.tbl_id.replace(/\./gi, '-');
		  	    	
		  	    	insertTr += '<tr onclick="analysisTargetTableColumnDatasetGet(\''+el.tbl_id+'\');">';
					insertTr += ' <td><input type="checkbox" name="tbl_id" id="'+table_id+'" value="'+el.tbl_id+'" disabled></td>';
					insertTr += ' <td>'+el.schemaname+'</td>';
					insertTr += ' <td>'+el.tablename+'</td>';
					insertTr += '</tr>';
		  	    });
		  	  $("#tableDataset").html(insertTr);
  	    	}
	  	  }
	  	  
	  	tableIsCheck();
	  	  
	  	for (let tbl_id of tbl_set){
	  		  let table_id = tbl_id.replace(/\./gi, '-');
	  		  $("#"+table_id).prop("checked",true); //등록 여부 체크
	  	  }
	  	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//시나리오 등록 > 분석 대상 설정 컬럼 조회
const analysisTargetTableColumnDatasetGet = function (tbl_id) {
	
	let query = isEmpty($("#query").val());
	
	const data = {
   		url: '/services/sandbox/B13001/scenarios/analysis-target/tables/'+tbl_id+'/columns/get',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/analysisTargetTableColumnDatasetGet',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#columnDataset").empty();
  	    	
  	    	if(data.contents != ""){
  	    		let insertTr = '';
		  	    $.each(data.contents, function (idx, el) {
		  	    	
		  	    	let uniqueId = tbl_id.replace(/\./gi, '-') + '-' + el.column_name;
		  	    	insertTr += '<tr>';
					insertTr += ' <td><input type="checkbox" name="column_uniqueId" value="'+uniqueId+'" onchange="addTableColumnDataset(this, \''+tbl_id+'\', \''+el.column_name+'\', \''+uniqueId+'\');"></td>';
					insertTr += ' <td>'+el.column_name+'</td>';
					insertTr += ' <td>'+el.data_type+'</td>';
					insertTr += ' <td>'+el.character_maximum_length+'</td>';
					insertTr += '</tr>';
					
		  	    });
		  	  $("#columnDataset").html(insertTr);
		  	  
		  		getTableColumnCheck();
  	    	}
	  	  }
	  	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//시나리오 등록 > 분석 대상 설정 상세 조회(테이블)
const analysisTargetTableDatasetsDetail = function () {
	
	let scenario_id = '{{scenario_id}}';
	
	
	const data = {
   		url: '/services/sandbox/scenarios/'+scenario_id+'/analysis-target/table-dataset/detail',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/analysisTargetTableDatasetsDetail',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#tableColumnDataset").empty();
  	    	
  	    	if(data.contents != ""){
  	    		
  	    		$("#anals_dataset_nm").val(data.contents.anals_dataset_nm);
	  	    	$("#anals_dataset_desc").val(data.contents.anals_dataset_desc);
  	    		
  	    		let insertTr = '';
		  	    $.each(data.contents.datasets, function (idx, el) {
		  	    	tbl_set.add(el.tbl_id);
					let uniqueId = el.tbl_id.replace(/\./gi, '-') + '-' + el.col_id;
					insertTr += '<tr id="'+uniqueId+'">';
					insertTr += ' <td></td>';
					insertTr += ' <td>'+el.tbl_id.split(".")[0]+'</td>';
					insertTr += ' <td class="blue bold" style="cursor:pointer" onclick="analysisTargetSampleData(\''+el.tbl_id+'\')">'+el.tbl_id.split(".")[1]+'</td>';
					insertTr += ' <td>'+el.col_id+'</td>';
					if(el.input_data_yn == 'Y'){
						insertTr += ' <td><input type="checkbox" name="input_chk" checked/></td>';
					}else{
						insertTr += ' <td><input type="checkbox" name="input_chk"/></td>';
					}
					if(el.output_data_yn == 'Y'){
						insertTr += ' <td><input type="checkbox" name="output_chk" checked/></td>';
					}else{
						insertTr += ' <td><input type="checkbox" name="output_chk"/></td>';
					}
					if(el.batch_std == 'Y'){
						insertTr += ' <td><input type="checkbox" name="batch_chk" checked/></td>';
					}else{
						insertTr += ' <td><input type="checkbox" name="batch_chk"/></td>';
					}
					
					insertTr += '</tr>';
					
		  	    });
		  	  $("#tableColumnDataset").html(insertTr);
  	    	}
	  	  }
	  	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//시나리오 등록 > 분석 대상 설정 샘플 데이터 조회
const analysisTargetSampleData = function (tbl_id) {
	
	let schema_nm = tbl_id.split('.')[0];
	let table_nm = tbl_id.split('.')[1];
	
	const data = {
   		url: '/services/sandbox/B13001/scenarios/analysis-target/tables/'+tbl_id+'/sample/get',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/analysisTargetSampleData',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#sampleDatasetColumn").empty();
	  		$("#sampleDatasetData").empty();
  	    	
  	    	if(data.contents != ""){
  	    		let insertColTr = '';
  	    		let insertDataTr = '';
  	    		
  	    		$("#schema_nm").text(schema_nm);
  	    		$("#table_nm").text(table_nm);
  	    		
  	    		insertColTr += '<tr>';
  	    		insertColTr += '<th></th>';
  	    		for(let col in data.contents[0]){
  	    			insertColTr += ' <th style="width:100px; word-break:break-all;">'+col+'</th>';
  	    		}
  	    		insertColTr += '</tr>';
  	    		
		  	    $.each(data.contents, function (idx, el) {
		  	    	
		  	    	insertDataTr += '<tr>';
		  	    	insertDataTr += '<td>'+Number(idx+1)+'</td>';
		  	    	for(let col in el){
		  	    		insertDataTr += ' <td>'+el[col]+'</td>';
		  	    	}
		  	    	insertDataTr += '</tr>';
					
		  	    });
		  	  	$("#sampleDatasetColumn").html(insertColTr);
		  		$("#sampleDatasetData").html(insertDataTr);
  	    	}
	  	  }
	  	detailModal();
	  	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//분석 대상 설정(테이블) 임시저장 & 저장 & 수정
const analysisTagetTableDatasetUpdate = function(type){
	let scenario_id = '{{scenario_id}}';
	let anals_dataset_nm = $("#anals_dataset_nm").val();
	let anals_dataset_desc = $("#anals_dataset_desc").val();
	let tableColumn_columns = new Array();
	let tableColumn_dataset_len = $("#tableColumnDataset > tr").length;
	let datasets = getTableColumnData();
	
	if(!anals_dataset_nm){
		alert('분석 데이터셋 이름을 입력하세요!');
		$("#anals_dataset_nm").focus();
        return;	
	}
	
	if(tableColumn_dataset_len == 0){
		alert('분석 데이터셋 컬럼 정의 데이터를 추가하세요!');
        return;	
	}
	
	let regstCd = '';
	let confirmMsg = '';
	if(type == 'T'){	//임시 저장
		regstCd = progressCd1;	//등록 중
		confirmMsg = '임시저장 하시겠습니까?';
	}else {		//다음
		regstCd = progressCd2;	//등록 완료
		confirmMsg = '저장 후 다음으로 이동하시겠습니까?';
	}
	
	const data = {
   		url: '/services/sandbox/scenarios/'+scenario_id+'/analysis-target/table-dataset/update',
   		user_id: 'user00',
   		menu_id: 'menu_id',
   		modifier_id: "modifier",
   		anals_dataset_nm: anals_dataset_nm,
   		anals_dataset_desc: anals_dataset_desc,
   		target_setup_status_cd: regstCd,
   		datasets: datasets,
    };
	
	if(confirm(confirmMsg)){
	    $.ajax({
	        type: 'POST',
	        url: url+'/analysisTagetTableDatasetUpdate',
	        dataType: 'json',
	        contentType: 'application/json; charset=utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
	    	let message = JSON.stringify(data.return_msg);
// 	  		alert(message.replace(/\"/gi, ''));
			alert("저장 되었습니다.");
	  		if(type == 'T'){	//임시저장
	  			jsNext(4, scenario_id);
	  		}else{	//다음
	  			jsList();
	  		}    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });	
	}
}

//분석 대상 설정 테이블/컬럼 상세 모음에 추가
const addTableColumnDataset = function(obj, tbl_id, column_name, uniqueId){
	
	let insertTr = '';
	if($(obj).is(':checked')){	//추가
		insertTr += '<tr id="'+uniqueId+'">';
		insertTr += ' <td></td>';
		insertTr += ' <td>'+tbl_id.split(".")[0]+'</td>';
		insertTr += ' <td class="blue bold" style="cursor:pointer" onclick="analysisTargetSampleData(\''+tbl_id+'\')">'+tbl_id.split(".")[1]+'</td>';
		insertTr += ' <td>'+column_name+'</td>';
		insertTr += ' <td><input type="checkbox" name="input_chk"/></td>';
		insertTr += ' <td><input type="checkbox" name="output_chk"/></td>';
		insertTr += ' <td><input type="checkbox" name="batch_chk"/></td>';
		insertTr += '</tr>';
		$("#tableColumnDataset").append(insertTr);
		//스크롤 아래로
		$("#tableColumnTbl").scrollTop($("#tableColumnTbl")[0].scrollHeight);
	}else{	//삭제
		$("#"+uniqueId).remove();
	}
	
	//번호 매기기
	$("#tableColumnDataset > tr").each(function(idx, el){
	   $(el).find(':first-child').text(idx+1);
	});
}

//분석 대상 설정 테이블/컬럼 상세 모음 데이터 있으면 컬럼 데이터 체크 
const getTableColumnCheck = function(){
	$("#tableColumnDataset > tr").each(function(idx, el){
		let id = $(el).attr("id");
		$('input:checkbox[name="column_uniqueId"][value="'+id+'"]').prop("checked",true);
	});
}

//분석 대상 설정 테이블/컬럼 임시저장 & 저장 & 수정 API datasets 데이터
const getTableColumnData = function(){
	
	let dataSets = new Array();
	
	$("#tableColumnDataset > tr").each(function(idx, el){
		let trObj = {};
		
		let id = $(el).attr("id");
		let schema_nm = id.split('-')[0];
		let table_nm = id.split('-')[1];
		let table_id = schema_nm + '.' + table_nm;
		let column_nm = id.split('-')[2];
		let input_data_yn = $("#" + id + "> td > input[name='input_chk']").is(":checked") ? 'Y' : 'N';
		let output_data_yn = $("#" + id + "> td > input[name='output_chk']").is(":checked") ? 'Y' : 'N';
		let batch_std = $("#" + id + "> td > input[name='batch_chk']").is(":checked") ? 'Y' : 'N';
		
		trObj['tbl_id'] = table_id;
		trObj['col_id'] = column_nm;
		trObj['input_data_yn'] = input_data_yn;
		trObj['output_data_yn'] = output_data_yn;
		trObj['batch_std'] = batch_std;
		
		dataSets.push(trObj);
		
	});
	
	return dataSets;
}

//테이블 등록여부 체크
const tableIsCheck = function(){
	for (let tbl_id of tbl_set){
		  let table_id = tbl_id.replace(/\./gi, '-');
		  $("#"+table_id).prop("checked",true); //등록 여부 체크
	  }
};

//임시저장 & 이전/다음 단계 이동
const jsNext = function(step){
	let anals_use_prpos_cd = '{{anals_use_prpos_cd}}';
	let scenario_id = '{{scenario_id}}';
	let anals_detail_setting_cd = '{{anals_detail_setting_cd}}';
	
	if(step == 'P'){	//이전 버튼
		if(anals_detail_setting_cd == setupCd1)	{	//분석 대상만 설정
			step = 1;
		}else if(anals_detail_setting_cd == setupCd2){	//분석 모델, 전처리 모델, 분석 대상 설정
			step = 3;
		}
	}
	
	if(step == 1){
		location.href='/sandbox/scenario/analysisScenario/step1/'+scenario_id;
	}else if(step == 2){
		location.href='/sandbox/scenario/analysisScenario/step2/'+anals_detail_setting_cd+'/'+anals_use_prpos_cd+'/'+scenario_id;
	}else if(step == 3){
		location.href='/sandbox/scenario/analysisScenario/step3/'+anals_detail_setting_cd+'/'+anals_use_prpos_cd+'/'+scenario_id;
	}else{
		location.href='/sandbox/scenario/analysisScenario/step4/'+anals_detail_setting_cd+'/'+anals_use_prpos_cd+'/'+scenario_id;
	}
	
}

//진행상태 표시 바
const progressBar = function(){
	let regst_status_cd = $("#regst_status_cd").val();
	let model_setup_status_cd = $("#model_setup_status_cd").val();
	let pretreat_status_cd = $("#pretreat_status_cd").val();
	let target_setup_status_cd = $("#target_setup_status_cd").val();
	
	if(regst_status_cd == progressCd1){
		$("#ps1").addClass("temporary_storage");
	}else if(regst_status_cd == progressCd2){
		$("#ps1").addClass("save");
	}
	
	if(model_setup_status_cd == progressCd1){
		$("#ps2").addClass("temporary_storage");
	}else if(model_setup_status_cd == progressCd2){
		$("#ps2").addClass("save");
	}
	
	if(pretreat_status_cd == progressCd1){
		$("#ps3").addClass("temporary_storage");
	}else if(pretreat_status_cd == progressCd2){
		$("#ps3").addClass("save");
	}
	
	if(target_setup_status_cd == progressCd1){
		$("#ps4").addClass("temporary_storage");
	}else{
		$("#ps4").addClass("now_depth");
	}
}

//모달 상세정보
const detailModal = function(){
	$('#add_modal').modal('show');
}

//분석 시나리오 목록 페이지 이동
const jsList = function(){
	location.href = '/sandbox/scenario/analysisScenario/list';
}

//엔터키가 눌렸을 때
const enterkey = function(e) {
	if (e.keyCode == 13) {
		analysisTargetTableDatasetsGet();
    }
}

//클릭 색상 변경
$('#tableDataset').on('click', 'tr', function(){
	$('#tableDataset > tr').removeClass();
	$(this).addClass("on");
});

//시나리오 등록 단계별 상태
scenarioEnrollStepStatus();

//분석 대상 설정 스키마 조회
analysisTargetSchemaGet();

</script>

