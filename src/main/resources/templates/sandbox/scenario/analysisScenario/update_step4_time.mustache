{{>layout/header}}

        <div class="right_col" role="main">
          <div class="row">
            <div class="col-md-12">
              <div class="x_panel"> 
                <div class="x_title"> 
                  <h2>시나리오</h2>
                  <div class="clearfix"> </div>
                </div>
                <div class="x_content"> <br>
                  <div class="scenario_depth"> 
                    <ul>
                      <li id="ps1">시나리오 작성</li>
                      <li id="ps2">분석모델 설정</li>
                      <li id="ps3">전처리 모델 설정</li>
                      <li id="ps4">분석 대상 설정</li>
                    </ul>
                  </div>
                  <div>
                    <div class="tab_item">
                      <h3>▣ 분석 시나리오 세부 정보 수정 - 분석 데이터셋 수정 </h3>
                      <div class="row mx-0">
                        <h4 class="center_title">분석 데이터셋 이름</h4>
                        <div class="form-group row col-12 col-md-12 mx-0">
                          <label class="control-label">분석 데이터셋 이름 <span class="red">*</span></label>
                          <div class="form-control_box col-md-10">
                            <input class="form-control" type="text">
                          </div>
                        </div>
                      </div>
                      <div class="row">
                         <h4 class="mt-4 center_title">분석 데이터셋 파일 검색 및 등록</h4>
                         <div class="x_content">
                         	<div class="col-6">
	                         	<div class="right_btns"> 
				                    <div class="row port_search">
				                      <div class="form-group row">
				                        <div class="form-control_box">
				                          <input class="form-control" type="text" name="query" id="query" onkeypress="enterkey(event);">
				                        </div>
				                      </div>
				                      <button class="btn btn-primary btn-sm" onclick="pretreatModels();">조회</button>
				                    </div>
			                  	</div>
		                  	</div>
                         </div>
                         <div class="metatable_box col-6">
                          	<div class="form-group row">
	                          <div class="table_responsive" style="height: 300px; overflow: auto">
	                            <table class="table table-striped table-bordered bulk_action">
	                              <colgroup>
	                                <col width="55px">
	                              </colgroup>
	                              <thead>
	                                <tr>
	                                  <th>등록여부</th>
	                                  <th>분석 테이블명(한글명)</th>
	                                  <th>분석 테이블명(영문명)</th>
	                                  <th>갱신 일자</th>
	                                  <th>데이터 수</th>
	                                </tr>
	                              </thead>
	                              <tbody>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>날씨</td>
	                                  <td>weather</td>
	                                  <td>20xx.xx.xx</td>
	                                  <td>100,992</td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>날씨</td>
	                                  <td>weather</td>
	                                  <td>20xx.xx.xx</td>
	                                  <td>100,992</td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>날씨</td>
	                                  <td>weather</td>
	                                  <td>20xx.xx.xx</td>
	                                  <td>100,992</td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>날씨</td>
	                                  <td>weather</td>
	                                  <td>20xx.xx.xx</td>
	                                  <td>100,992</td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>날씨</td>
	                                  <td>weather</td>
	                                  <td>20xx.xx.xx</td>
	                                  <td>100,992</td>
	                                </tr>
	                              </tbody>
	                            </table>
	                          </div>
	                   		</div>
                   	  	</div>
                   	  	<div class="metatable_box col-6 col-lg-6">
                          <div class="form-group row">
	                          <div class="table_responsive" style="height: 300px; overflow: auto">
	                            <table class="table table-striped table-bordered bulk_action">
	                              <colgroup>
	                                <col width="55px">
	                              </colgroup>
	                              <thead>
	                                <tr>
	                                  <th>선택</th>
	                                  <th>컬럼명(한글)</th>
	                                  <th>컬럼명(영문)</th>
	                                  <th>컬럼 타입</th>
	                                  <th>컬럼 길이</th>
	                                </tr>
	                              </thead>
	                              <tbody>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>이산화탄소</td>
	                                  <td>CO2</td>
	                                  <td></td>
	                                  <td></td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>이산화탄소</td>
	                                  <td>CO2</td>
	                                  <td></td>
	                                  <td></td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>이산화탄소</td>
	                                  <td>CO2</td>
	                                  <td></td>
	                                  <td></td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>이산화탄소</td>
	                                  <td>CO2</td>
	                                  <td></td>
	                                  <td></td>
	                                </tr>
	                                <tr>
	                                  <td>
	                                    <input type="checkbox" name="table_records">
	                                  </td>
	                                  <td>이산화탄소</td>
	                                  <td>CO2</td>
	                                  <td></td>
	                                  <td></td>
	                                </tr>
	                              </tbody>
	                            </table>
	                          </div>
	                    	</div>
                   	  	</div>
                      </div>
                      <div class="row">
                         <h4 class="mt-4 center_title">분석 데이터셋 컬럼 정의 <span class="red bold">*</span></h4>
                         <div class="metatable_box col-12">
                          	<div class="form-group row">
	                          <div class="table_responsive" style="height: 300px; overflow: auto">
	                            <table class="table table-striped table-bordered bulk_action">
	                              <colgroup>
	                                <col width="55px">
	                              </colgroup>
	                              <thead>
	                                <tr>
	                                  <th>#</th>
	                                  <th>분석 테이블명(한글명)</th>
	                                  <th>분석 테이블명(영문명)</th>
	                                  <th>컬럼명(한글)</th>
	                                  <th>컬럼명(영문)</th>
	                                  <th>컬럼 타입</th>
	                                  <th>컬럼 길이</th>
	                                  <th>Input Data</th>
	                                  <th>Output Data</th>
	                                </tr>
	                              </thead>
	                              <tbody>
	                                <tr>
	                                  <td>1</td>
	                                  <td>날씨</td>
	                                  <td onclick="detailModal();"><span class="blue bold" style="cursor:pointer">weather</span></td>
	                                  <td>습도</td>
	                                  <td>Humidity</td>
	                                  <td></td>
	                                  <td></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                </tr>
	                                <tr>
	                                  <td>2</td>
	                                  <td>날씨</td>
	                                  <td><span class="blue bold" style="cursor:pointer">weather</span></td>
	                                  <td>습도</td>
	                                  <td>Humidity</td>
	                                  <td></td>
	                                  <td></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                </tr>
	                                <tr>
	                                  <td>3</td>
	                                  <td>날씨</td>
	                                  <td><span class="blue bold" style="cursor:pointer">weather</span></td>
	                                  <td>습도</td>
	                                  <td>Humidity</td>
	                                  <td></td>
	                                  <td></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                </tr>
	                                <tr>
	                                  <td>4</td>
	                                  <td>날씨</td>
	                                  <td><span class="blue bold" style="cursor:pointer">weather</span></td>
	                                  <td>습도</td>
	                                  <td>Humidity</td>
	                                  <td></td>
	                                  <td></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                </tr>
	                                <tr>
	                                  <td>5</td>
	                                  <td>날씨</td>
	                                  <td><span class="blue bold" style="cursor:pointer">weather</span></td>
	                                  <td>습도</td>
	                                  <td>Humidity</td>
	                                  <td></td>
	                                  <td></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                  <td><input type="checkbox" name="table_records"></td>
	                                </tr>
	                              </tbody>
	                            </table>
	                          </div>
	                   		</div>
                   	  	</div>
                      </div>
                      <div class="row"> 
	                    <div class="metatable_box col-12">
	                      <h4 class="center_title">분석 데이터셋 설명</h4>
	                      <div class="form-group row">
	                        <label class="control-label">분석 데이터셋 설명</label>
	                        <div class="form-control_box duplicate_box">
	                          <input class="form-control" type="text" placeholder="분석 데이터셋 설명">
	                        </div>
	                      </div>
	                    </div>
	                  </div>
                      <div class="right_btns mt-4">
                        <button class="btn btn-success" onclick="analysisImageTargetSettingUpdate();">수정</button>
                        <button class="btn btn-primary" onclick="jsList();">목록</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- modal -->
        <div class="modal fade add_modal" id="add_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-md">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel"><span id="modelLabel">샘플 데이터 팝업</span></h4>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
                <div class="x_content"> 
                  <div class="table_responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr> 
                          <th colspan="2">▣ 테이블 정보</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                  <div class="border_rows">
                    <div class="row">
                      <div class="form-group row col-12 col-md-12">
                        <div class="control-label">테이블명(한글)</div>
                        <div class="form-control_box" id="anals_model_nm"></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-12">
                        <div class="control-label">테이블명(영문)</div>
                        <div class="form-control_box" id="anals_model_desc"></div>
                      </div>
                    </div>
                  </div>
                  <div class="table_responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr> 
                          <th colspan="2">▣ 샘플 데이터</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                  <div class="table_responsive">
                    <table class="table table-striped">
                   	  <colgroup> 
                        <col width="55px">
                      </colgroup>
                      <thead>
                        <tr> 
                          <th></th>
                          <th>timestamp</th>
                          <th>pm10</th>
                          <th>co2</th>
                          <th>no2</th>
                        </tr>
                      </thead>
                      <tbody id="sample_data">
                      	<tr>
                      		<td>1</td>
                      		<td>t1</td>
                      		<td>x</td>
                      		<td>x</td>
                      		<td>x</td>
                      	</tr>
                      	<tr>
                      		<td>2</td>
                      		<td>t1</td>
                      		<td>x</td>
                      		<td>x</td>
                      		<td>x</td>
                      	</tr>
                      	<tr>
                      		<td>3</td>
                      		<td>t1</td>
                      		<td>x</td>
                      		<td>x</td>
                      		<td>x</td>
                      	</tr>
                      	<tr>
                      		<td>4</td>
                      		<td>t1</td>
                      		<td>x</td>
                      		<td>x</td>
                      		<td>x</td>
                      	</tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" type="button" data-dismiss="modal">확인</button>
              </div>
            </div>
          </div>
        </div>
        <input type="hidden" name="regst_status_cd" id="regst_status_cd"/>
        <input type="hidden" name="model_setup_status_cd" id="model_setup_status_cd"/>
        <input type="hidden" name="pretreat_status_cd" id="pretreat_status_cd"/>
        <input type="hidden" name="target_setup_status_cd" id="target_setup_status_cd"/>
        <input type="hidden" name="last_status_cd" id="last_status_cd"/>
        
{{>layout/footer}}        

<script>
const commonUrl = '/sandbox/common';
const url = '/sandbox/scenario/analysisScenario';

const progressCd1 = 'B03001';	//등록 중
const progressCd2 = 'B03002';	//등록 완료

const setupCd1 = 'B01001'	//분석 대상만 설정
const setupCd2 = 'B01002'	//분석 모델, 전처리 모델, 분석 대상 설정

$(document).ready(function(){
	let anals_detail_setting_cd = '{{anals_detail_setting_cd}}';
	
	if($("#regst_status_cd").val() != progressCd2){
		alert("시나리오 작성이 완료되지 않았습니다. 시나리오 작성 페이지로 이동합니다.");
		jsNext(1);
		return;
	}
	
	if(anals_detail_setting_cd == setupCd2){	//분석 모델, 전처리 모델, 분석 대상 설정
		if($("#model_setup_status_cd").val() != progressCd2){
			alert("분석모델 설정이 완료되지 않았습니다. 분석모델 설정 페이지로 이동합니다.");
			jsNext(2);
			return;
		}
		
		if($("#pretreat_status_cd").val() != progressCd2){
			alert("전처리 모델 설정이 완료되지 않았습니다. 분석모델 설정 페이지로 이동합니다.");
			jsNext(3);
			return;
		}
	}
	
	progressBar();
});

//시나리오 등록 단계별 상태
const scenarioEnrollStepStatus = function (){
	let scenario_id = '{{scenario_id}}';
	if(!scenario_id){
		return;
	}
	
	const data = {
   		url: '/services/sandbox/scenarios/'+scenario_id+'/enroll-status',
   		user_id: 'user00',	
   		menu_id: 'menu_id',
    };
	
	$.ajax({
        type: 'POST',
        url: url+'/scenarioEnrollStepStatus',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data),
        async: false,
    }).done(function (data) {
    	
    	 if (data != null) {
   	    	
   	    	if(data.contents != ""){
   	    		$("#regst_status_cd").val(data.contents.regst_status_cd);
   	    		$("#model_setup_status_cd").val(data.contents.model_setup_status_cd);
   	    		$("#pretreat_status_cd").val(data.contents.pretreat_status_cd);
   	    		$("#target_setup_status_cd").val(data.contents.target_setup_status_cd);
   	    		$("#last_status_cd").val(data.contents.last_status_cd);
   	    	}
    	 }
  		
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//임시저장 & 이전/다음 단계 이동
const jsNext = function(){
	let anals_use_prpos_cd = '{{anals_use_prpos_cd}}';
	let scenario_id = '{{scenario_id}}';
	let anals_detail_setting_cd = '{{anals_detail_setting_cd}}';
	
	if(anals_detail_setting_cd == setupCd1)	{	//분석 대상만 설정
		location.href='/sandbox/scenario/analysisScenario/update/step1/'+scenario_id;
	}else if(anals_detail_setting_cd == setupCd2){	//분석 모델, 전처리 모델, 분석 대상 설정
		location.href='/sandbox/scenario/analysisScenario/update/step3/'+anals_detail_setting_cd+'/'+anals_use_prpos_cd+'/'+scenario_id;
	}
	
}

//진행상태 표시 바
const progressBar = function(){
	let regst_status_cd = $("#regst_status_cd").val();
	let model_setup_status_cd = $("#model_setup_status_cd").val();
	let pretreat_status_cd = $("#pretreat_status_cd").val();
	let target_setup_status_cd = $("#target_setup_status_cd").val();
	let scenario_id = '{{scenario_id}}';
	
	if(regst_status_cd){
		$("#ps1").attr("onclick","jsNext('1')");
		$("#ps1").attr("style","cursor:pointer");
	}
	
	if(model_setup_status_cd){
		$("#ps2").attr("onclick","jsNext('2')");
		$("#ps2").attr("style","cursor:pointer");
	}
	
	if(pretreat_status_cd){
		$("#ps3").attr("onclick","jsNext('3')");
		$("#ps3").attr("style","cursor:pointer");
	}
	
	if(target_setup_status_cd){
		$("#ps4").attr("onclick","jsNext('4')");
		$("#ps4").attr("style","cursor:pointer");
	}
	
	if(regst_status_cd == progressCd1){
		$("#ps1").addClass("temporary_storage");
	}else if(regst_status_cd == progressCd2){
		$("#ps1").addClass("save");
	}
	
	if(model_setup_status_cd == progressCd1){
		$("#ps2").addClass("temporary_storage");
	}else if(model_setup_status_cd == progressCd2){
		$("#ps2").addClass("save");
	}
	
	if(pretreat_status_cd == progressCd1){
		$("#ps3").addClass("temporary_storage");
	}else if(pretreat_status_cd == progressCd2){
		$("#ps3").addClass("save");
	}
	
	if(target_setup_status_cd == progressCd1){
		$("#ps4").addClass("temporary_storage");
	}else{
		$("#ps4").addClass("now_depth");
	}
}

//모달 상세정보
const detailModal = function(){
	$('#add_modal').modal('show');
}

//분석 시나리오 목록 페이지 이동
const jsList = function(){
	location.href = '/sandbox/scenario/analysisScenario/list';
}

//시나리오 등록 단계별 상태
scenarioEnrollStepStatus();
</script>

